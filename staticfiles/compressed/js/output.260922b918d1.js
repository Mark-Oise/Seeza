;const elements={sidebar:document.getElementById('sidebar'),mainContent:document.getElementById('main-content'),backdrop:document.getElementById('sidebarBackdrop'),toggleMobile:document.getElementById('toggleSidebarMobile'),toggleDesktop:document.getElementById('toggleSidebarDesktop'),closeMobile:document.getElementById('closeSidebarMobile'),close:document.getElementById('closeSidebar')};if(elements.sidebar){const toggleClasses=(element,classes,action)=>{classes.forEach(cls=>element.classList[action](cls));};const updateSidebarState=(isExpanded)=>{const action=isExpanded?'remove':'add';toggleClasses(elements.sidebar,['lg:translate-x-0','-translate-x-full'],action);toggleClasses(elements.mainContent,['lg:ml-64','lg:ml-0'],action);toggleClasses(document.body,['sidebar-expanded'],action);toggleClasses(document.documentElement,['sidebar-collapsed'],!action);localStorage.setItem('sidebarExpanded',isExpanded);};const toggleMobileSidebar=()=>{const isClosed=elements.sidebar.classList.contains('-translate-x-full');toggleClasses(elements.sidebar,['-translate-x-full'],!isClosed);toggleClasses(elements.backdrop,['hidden'],!isClosed);toggleClasses(document.body,['overflow-hidden'],isClosed);};const closeMobileSidebar=()=>{if(window.innerWidth<1024){toggleClasses(elements.sidebar,['-translate-x-full'],'add');toggleClasses(elements.backdrop,['hidden'],'add');toggleClasses(document.body,['overflow-hidden'],'remove');}};elements.toggleMobile?.addEventListener('click',toggleMobileSidebar);elements.backdrop?.addEventListener('click',toggleMobileSidebar);elements.closeMobile?.addEventListener('click',toggleMobileSidebar);elements.close?.addEventListener('click',()=>updateSidebarState(false));elements.toggleDesktop?.addEventListener('click',()=>{const isExpanded=elements.sidebar.classList.contains('lg:translate-x-0');updateSidebarState(!isExpanded);});document.addEventListener('click',(event)=>{if(window.innerWidth<1024&&!elements.sidebar.contains(event.target)&&!event.target.closest('#toggleSidebarMobile')){closeMobileSidebar();}});const initSidebarState=()=>{const savedState=localStorage.getItem('sidebarExpanded');if(savedState!==null&&window.innerWidth>=1024){updateSidebarState(JSON.parse(savedState));}};initSidebarState();setTimeout(initSidebarState,50);};const DOM={chatContainer:document.getElementById('chat-container'),messageList:document.getElementById('message-list'),initialTextareaHeight:null};const utils={isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);},scrollToBottom(){if(DOM.chatContainer){DOM.chatContainer.scrollTop=DOM.chatContainer.scrollHeight;}}};const formHandler={submit(form){const textarea=form.querySelector('textarea');if(!textarea?.value.trim())return;if(form.id==='message-input-home'){form.submit();}else if(form.id==='message-input-detail'){htmx.trigger(form,'submit');}
this.clearTextarea(textarea);},clearTextarea(textarea){textarea.value='';textarea.style.height=DOM.initialTextareaHeight||'auto';},handleKeyPress(event){if(!utils.isMobileDevice()&&event.key==='Enter'&&!event.shiftKey){event.preventDefault();const form=event.target.closest('form');form&&formHandler.submit(form);}}};const textareaManager={setup(textarea){textarea.addEventListener('input',()=>{textarea.style.height='auto';textarea.style.height=Math.min(textarea.scrollHeight,120)+'px';});textarea.addEventListener('keypress',formHandler.handleKeyPress);if(!DOM.initialTextareaHeight){DOM.initialTextareaHeight=window.getComputedStyle(textarea).height;}}};function initializeForms(){document.querySelectorAll('#message-input-home, #message-input-detail').forEach(form=>{const textarea=form.querySelector('textarea');const submitButton=form.querySelector('button[type="submit"]');textarea&&textareaManager.setup(textarea);submitButton?.addEventListener('click',(event)=>{event.preventDefault();formHandler.submit(form);});});}
function setupMessageObserver(element,config={}){if(!element)return;const observer=new MutationObserver(()=>utils.scrollToBottom());observer.observe(element,{childList:true,subtree:true,characterData:true,...config});}
document.body.addEventListener('htmx:wsAfterSend',(evt)=>{const textarea=evt.detail.elt.querySelector('textarea');textarea&&formHandler.clearTextarea(textarea);utils.scrollToBottom();});document.body.addEventListener('htmx:afterOnLoad',(event)=>{if(event.detail.elt.id==='message-list'){utils.scrollToBottom();}});document.addEventListener('DOMContentLoaded',utils.scrollToBottom);window.addEventListener('load',initializeForms);document.body.addEventListener('htmx:afterSettle',initializeForms);setupMessageObserver(DOM.messageList);setupMessageObserver(DOM.chatContainer);console.log('Chat management system initialized');;function applySyntaxHighlighting(element=document){element.querySelectorAll('pre code').forEach((block)=>{hljs.highlightElement(block);});}
document.addEventListener('DOMContentLoaded',()=>{applySyntaxHighlighting();});document.body.addEventListener('htmx:afterSwap',(event)=>{applySyntaxHighlighting(event.detail.elt);});document.body.addEventListener('htmx:wsAfterMessage',()=>{applySyntaxHighlighting();});;